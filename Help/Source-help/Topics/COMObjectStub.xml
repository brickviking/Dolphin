<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title translate="true">COMObjectStub</title>
  <body>
    <header>
      <para styleclass="Heading1"><text styleclass="Heading1" translate="true">COMObjectStub</text></para>
    </header>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">A server object is required by COM to maintain a reference count on a per-object (not per-interface) basis. Dolphin</text><text styleclass="Normal" translate="true">’</text><text styleclass="Normal" translate="true">s COM framework provides this functionality for you. A natural place to implement it would be in </text><text styleclass="Class Name" translate="true">COMInterfaceImp</text><text styleclass="Normal" translate="true">, but to avoid requiring that all COM server objects be subclassed from a particular class (an undesirable limitation in a language with only single-inheritance), reference count based lifetime management and the basic mechanics for </text><text styleclass="Class Name" translate="true">QueryInterface</text><text styleclass="Normal" translate="true">,and aggregation, are provided by a separate class, </text><text styleclass="Class Name" translate="true">COMObjectStub</text><text styleclass="Normal" translate="true">. Instances of </text><text styleclass="Class Name" translate="true">COMObjectStub</text><text styleclass="Normal" translate="true"> act as proxies that sit between the actual server implementation class and the clients. They receive all virtual function calls: </text><text styleclass="Class Name" translate="true">AddRef</text><text styleclass="Normal" translate="true"> and Release are handled locally, </text><text styleclass="Class Name" translate="true">QueryInterface</text><text styleclass="Normal" translate="true"> is handled locally with support from the server object (via its implentation of </text><text styleclass="Class Name" translate="true">#queryInterface:[ifNone:]</text><text styleclass="Normal" translate="true">), and invocations of other interface methods are forwarded as Smalltalk messages to the server objects.</text></para>
    <para styleclass="Normal"><text styleclass="Class Name" translate="true">COMObjectStub</text><text styleclass="Normal" translate="true"> will keep a server object alive for as long as there are references to COM interfaces onto it. When the reference count that it maintains drops to zero it informs the server object by sending it the </text><text styleclass="Class Name" translate="true">#finalRelease</text><text styleclass="Normal" translate="true"> message, and then removes itself from the table of live stubs.</text></para>
  </body>
</topic>
